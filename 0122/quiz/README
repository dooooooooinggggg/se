Version 1, single-thread